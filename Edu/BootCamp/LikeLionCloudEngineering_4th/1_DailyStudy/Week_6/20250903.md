# JWT ì™„ì „ ê°€ì´ë“œ ğŸ“š
*Spring Boot + Thymeleaf + JPA + CORS ì¢…í•© ì‹¤ìŠµ*

## ëª©ì°¨
1. [JWT ê¸°ë³¸ ê°œë…](#jwt-ê¸°ë³¸-ê°œë…)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
3. [ì˜ì¡´ì„± ì„¤ì •](#ì˜ì¡´ì„±-ì„¤ì •)
4. [JWT êµ¬í˜„](#jwt-êµ¬í˜„)
5. [Spring Security ì„¤ì •](#spring-security-ì„¤ì •)
6. [JPA ì—”í‹°í‹° ì„¤ì •](#jpa-ì—”í‹°í‹°-ì„¤ì •)
7. [CORS ì„¤ì •](#cors-ì„¤ì •)
8. [Thymeleaf í…œí”Œë¦¿](#thymeleaf-í…œí”Œë¦¿)
9. [ì‹¤ë¬´ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#ì‹¤ë¬´-ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)

---

## JWT ê¸°ë³¸ ê°œë…

### JWTë€?
JWT(JSON Web Token)ëŠ” ë‹¹ì‚¬ì ê°„ì— ì •ë³´ë¥¼ JSON ê°ì²´ë¡œ ì•ˆì „í•˜ê²Œ ì „ì†¡í•˜ê¸° ìœ„í•œ ì»´íŒ©íŠ¸í•˜ê³  ë…ë¦½ì ì¸ ë°©ë²•ì„ ì •ì˜í•˜ëŠ” ê°œë°©í˜• í‘œì¤€(RFC 7519)ì…ë‹ˆë‹¤.

### JWT êµ¬ì¡°
```mermaid
graph LR
    A[Header] --> B[.]
    B --> C[Payload]
    C --> D[.]
    D --> E[Signature]
    
    style A fill:#e1f5fe
    style C fill:#f3e5f5
    style E fill:#fff3e0
```

### JWT ì¸ì¦ í”Œë¡œìš°
```mermaid
sequenceDiagram
    participant C as Client
    participant S as Server
    participant DB as Database
    
    C->>S: 1. ë¡œê·¸ì¸ ìš”ì²­ (username, password)
    S->>DB: 2. ì‚¬ìš©ì ì¸ì¦
    DB-->>S: 3. ì¸ì¦ ê²°ê³¼
    S-->>C: 4. JWT í† í° ë°œê¸‰
    C->>S: 5. API ìš”ì²­ (Authorization: Bearer JWT)
    S->>S: 6. JWT ê²€ì¦
    S-->>C: 7. ì‘ë‹µ ë°ì´í„°
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â””â”€â”€ com/
â”‚   â”‚       â””â”€â”€ example/
â”‚   â”‚           â””â”€â”€ jwt/
â”‚   â”‚               â”œâ”€â”€ JwtApplication.java
â”‚   â”‚               â”œâ”€â”€ config/
â”‚   â”‚               â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”‚               â”‚   â”œâ”€â”€ JwtConfig.java
â”‚   â”‚               â”‚   â””â”€â”€ CorsConfig.java
â”‚   â”‚               â”œâ”€â”€ entity/
â”‚   â”‚               â”‚   â””â”€â”€ User.java
â”‚   â”‚               â”œâ”€â”€ repository/
â”‚   â”‚               â”‚   â””â”€â”€ UserRepository.java
â”‚   â”‚               â”œâ”€â”€ service/
â”‚   â”‚               â”‚   â”œâ”€â”€ JwtService.java
â”‚   â”‚               â”‚   â””â”€â”€ UserService.java
â”‚   â”‚               â”œâ”€â”€ controller/
â”‚   â”‚               â”‚   â”œâ”€â”€ AuthController.java
â”‚   â”‚               â”‚   â””â”€â”€ HomeController.java
â”‚   â”‚               â””â”€â”€ security/
â”‚   â”‚                   â”œâ”€â”€ JwtAuthenticationFilter.java
â”‚   â”‚                   â””â”€â”€ JwtAuthenticationProvider.java
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ templates/
â”‚       â”‚   â”œâ”€â”€ login.html
â”‚       â”‚   â”œâ”€â”€ dashboard.html
â”‚       â”‚   â””â”€â”€ layout.html
â”‚       â””â”€â”€ application.yml
```

---

## ì˜ì¡´ì„± ì„¤ì •

### build.gradle
```gradle
dependencies {
    // Spring Boot ê¸°ë³¸ ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    
    // JWT ê´€ë ¨ ì˜ì¡´ì„±
    implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.12.3'
    
    // ë°ì´í„°ë² ì´ìŠ¤
    runtimeOnly 'com.h2database:h2'
    
    // ê°œë°œ ë„êµ¬
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
}
```

---

## JWT êµ¬í˜„

### JWT ì„œë¹„ìŠ¤
```java
@Service
@Component
public class JwtService {
    
    // JWT ì„œëª…ì— ì‚¬ìš©í•  ë¹„ë°€í‚¤ (ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬)
    private final String SECRET_KEY = "mySecretKeyForJWTTokenGenerationThatShouldBeLongEnough";
    
    // í† í° ë§Œë£Œì‹œê°„ (24ì‹œê°„)
    private final long EXPIRATION_TIME = 24 * 60 * 60 * 1000;
    
    /**
     * ì‚¬ìš©ì ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ JWT í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.
     * @param username ì‚¬ìš©ìëª…
     * @param roles ì‚¬ìš©ì ê¶Œí•œ ë¦¬ìŠ¤íŠ¸
     * @return ìƒì„±ëœ JWT í† í°
     */
    public String generateToken(String username, List<String> roles) {
        // í˜„ì¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ í† í° ë°œê¸‰ ì‹œê°„ ì„¤ì •
        Date now = new Date();
        // ë§Œë£Œ ì‹œê°„ ì„¤ì • (í˜„ì¬ì‹œê°„ + ë§Œë£Œì‹œê°„)
        Date expiryDate = new Date(now.getTime() + EXPIRATION_TIME);
        
        return Jwts.builder()
                .setSubject(username)                    // í† í° ì£¼ì²´(ì‚¬ìš©ìëª…) ì„¤ì •
                .claim("roles", roles)                   // ì‚¬ìš©ì ê¶Œí•œ ì •ë³´ ì¶”ê°€
                .setIssuedAt(now)                       // í† í° ë°œê¸‰ ì‹œê°„ ì„¤ì •
                .setExpiration(expiryDate)              // í† í° ë§Œë£Œ ì‹œê°„ ì„¤ì •
                .signWith(getSigningKey())              // ë¹„ë°€í‚¤ë¡œ ì„œëª…
                .compact();                             // í† í° ë¬¸ìì—´ë¡œ ì••ì¶•
    }
    
    /**
     * JWT í† í°ì—ì„œ ì‚¬ìš©ìëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
     * @param token JWT í† í°
     * @return ì‚¬ìš©ìëª…
     */
    public String getUsernameFromToken(String token) {
        // í† í°ì„ íŒŒì‹±í•˜ì—¬ í´ë ˆì„ ì •ë³´ ì¶”ì¶œ
        Claims claims = Jwts.parserBuilder()
                .setSigningKey(getSigningKey())         // ê²€ì¦ì— ì‚¬ìš©í•  í‚¤ ì„¤ì •
                .build()
                .parseClaimsJws(token)                  // í† í° íŒŒì‹± ë° ê²€ì¦
                .getBody();                             // í˜ì´ë¡œë“œ ì¶”ì¶œ
        
        return claims.getSubject();                     // ì£¼ì²´(ì‚¬ìš©ìëª…) ë°˜í™˜
    }
    
    /**
     * JWT í† í°ì—ì„œ ê¶Œí•œ ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
     * @param token JWT í† í°
     * @return ê¶Œí•œ ë¦¬ìŠ¤íŠ¸
     */
    @SuppressWarnings("unchecked")
    public List<String> getRolesFromToken(String token) {
        Claims claims = Jwts.parserBuilder()
                .setSigningKey(getSigningKey())
                .build()
                .parseClaimsJws(token)
                .getBody();
        
        // roles í´ë ˆì„ì„ List<String>ìœ¼ë¡œ ìºìŠ¤íŒ…í•˜ì—¬ ë°˜í™˜
        return (List<String>) claims.get("roles");
    }
    
    /**
     * JWT í† í°ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.
     * @param token JWT í† í°
     * @return ìœ íš¨í•˜ë©´ true, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ false
     */
    public boolean validateToken(String token) {
        try {
            Jwts.parserBuilder()
                    .setSigningKey(getSigningKey())     // ì„œëª… ê²€ì¦ìš© í‚¤ ì„¤ì •
                    .build()
                    .parseClaimsJws(token);             // í† í° íŒŒì‹± ì‹œë„
            return true;                                // ì˜ˆì™¸ ì—†ì´ íŒŒì‹±ë˜ë©´ ìœ íš¨í•œ í† í°
        } catch (JwtException | IllegalArgumentException e) {
            // í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ê²½ìš°
            return false;
        }
    }
    
    /**
     * ë¬¸ìì—´ ë¹„ë°€í‚¤ë¥¼ ì•”í˜¸í™” í‚¤ ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
     * @return ì„œëª…ìš© í‚¤ ê°ì²´
     */
    private Key getSigningKey() {
        // ë¹„ë°€í‚¤ë¥¼ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ë³€í™˜ í›„ HMAC SHA í‚¤ë¡œ ìƒì„±
        byte[] keyBytes = SECRET_KEY.getBytes();
        return Keys.hmacShaKeyFor(keyBytes);
    }
}
```

---

## JPA ì—”í‹°í‹° ì„¤ì •

### User ì—”í‹°í‹°
```java
@Entity
@Table(name = "users")  // 'user'ëŠ” SQL ì˜ˆì•½ì–´ì´ë¯€ë¡œ 'users' ì‚¬ìš©
@Data                   // Lombok: getter, setter, toString ë“± ìë™ ìƒì„±
@NoArgsConstructor     // Lombok: ê¸°ë³¸ ìƒì„±ì ìë™ ìƒì„±
@AllArgsConstructor    // Lombok: ëª¨ë“  í•„ë“œë¥¼ í¬í•¨í•œ ìƒì„±ì ìë™ ìƒì„±
public class User {
    
    @Id                                 // ê¸°ë³¸í‚¤ ì§€ì •
    @GeneratedValue(strategy = GenerationType.IDENTITY)  // ìë™ ì¦ê°€ ì„¤ì •
    private Long id;
    
    @Column(unique = true, nullable = false)  // ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´, null ë¶ˆí—ˆ
    private String username;
    
    @Column(nullable = false)           // null ë¶ˆí—ˆ
    private String password;
    
    @Column(nullable = false)           // null ë¶ˆí—ˆ
    private String email;
    
    // ì‚¬ìš©ì ê¶Œí•œì„ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ì €ì¥ (ì˜ˆ: "USER,ADMIN")
    @Column(nullable = false)
    private String roles = "USER";      // ê¸°ë³¸ê°’: USER ê¶Œí•œ
    
    /**
     * ê¶Œí•œ ë¬¸ìì—´ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @return ê¶Œí•œ ë¦¬ìŠ¤íŠ¸
     */
    public List<String> getRoleList() {
        // ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ê¶Œí•œ ë¬¸ìì—´ì„ ë¶„í• í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
        return Arrays.stream(roles.split(","))
                .map(String::trim)      // ê³µë°± ì œê±°
                .collect(Collectors.toList());
    }
}
```

### User Repository
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    
    /**
     * ì‚¬ìš©ìëª…ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
     * @param username ì‚¬ìš©ìëª…
     * @return Optionalë¡œ ê°ì‹¸ì§„ User ê°ì²´
     */
    Optional<User> findByUsername(String username);
    
    /**
     * ì‚¬ìš©ìëª…ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
     * @param username ì‚¬ìš©ìëª…
     * @return ì¡´ì¬í•˜ë©´ true, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ false
     */
    boolean existsByUsername(String username);
    
    /**
     * ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
     * @param email ì´ë©”ì¼
     * @return ì¡´ì¬í•˜ë©´ true, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ false
     */
    boolean existsByEmail(String email);
}
```

---

## Spring Security ì„¤ì •

### JWT ì¸ì¦ í•„í„°
```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private JwtService jwtService;
    
    /**
     * ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ JWT í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤.
     */
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response, 
                                  FilterChain filterChain) throws ServletException, IOException {
        
        // Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ
        String token = getTokenFromRequest(request);
        
        // í† í°ì´ ì¡´ì¬í•˜ê³  ìœ íš¨í•œ ê²½ìš°
        if (token != null && jwtService.validateToken(token)) {
            // í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
            String username = jwtService.getUsernameFromToken(token);
            List<String> roles = jwtService.getRolesFromToken(token);
            
            // Spring Security ê¶Œí•œ ê°ì²´ ìƒì„±
            List<SimpleGrantedAuthority> authorities = roles.stream()
                    .map(role -> new SimpleGrantedAuthority("ROLE_" + role))  // ROLE_ ì ‘ë‘ì‚¬ ì¶”ê°€
                    .collect(Collectors.toList());
            
            // ì¸ì¦ í† í° ìƒì„±
            UsernamePasswordAuthenticationToken authToken = 
                    new UsernamePasswordAuthenticationToken(username, null, authorities);
            
            // SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì •
            SecurityContextHolder.getContext().setAuthentication(authToken);
        }
        
        // ë‹¤ìŒ í•„í„°ë¡œ ìš”ì²­ ì „ë‹¬
        filterChain.doFilter(request, response);
    }
    
    /**
     * HTTP ìš”ì²­ì—ì„œ JWT í† í°ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
     * @param request HTTP ìš”ì²­
     * @return JWT í† í° ë˜ëŠ” null
     */
    private String getTokenFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        
        // Authorization í—¤ë”ê°€ ì¡´ì¬í•˜ê³  "Bearer "ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);  // "Bearer " ì´í›„ì˜ í† í° ë¶€ë¶„ë§Œ ì¶”ì¶œ
        }
        return null;
    }
}
```

### Security ì„¤ì •
```java
@Configuration
@EnableWebSecurity  // Spring Security í™œì„±í™”
public class SecurityConfig {
    
    @Autowired
    private JwtAuthenticationFilter jwtAuthenticationFilter;
    
    /**
     * ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ ìœ„í•œ PasswordEncoder Bean ë“±ë¡
     */
    @Bean
    public PasswordEncoder passwordEncoder() {
        // BCrypt í•´ì‹œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
        return new BCryptPasswordEncoder();
    }
    
    /**
     * Spring Security ì„¤ì •
     */
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                // CSRF ë³´í˜¸ ë¹„í™œì„±í™” (JWT ì‚¬ìš© ì‹œ ì¼ë°˜ì )
                .csrf(csrf -> csrf.disable())
                
                // ì„¸ì…˜ ê´€ë¦¬ ì •ì±… ì„¤ì • (JWTëŠ” stateless)
                .sessionManagement(session -> 
                        session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                
                // URLë³„ ì ‘ê·¼ ê¶Œí•œ ì„¤ì •
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/auth/**", "/login", "/register").permitAll()  // ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥
                        .requestMatchers("/css/**", "/js/**", "/images/**").permitAll()   // ì •ì  ë¦¬ì†ŒìŠ¤ í—ˆìš©
                        .requestMatchers("/admin/**").hasRole("ADMIN")                    // ADMIN ê¶Œí•œ í•„ìš”
                        .anyRequest().authenticated()                                     // ë‚˜ë¨¸ì§€ëŠ” ì¸ì¦ í•„ìš”
                )
                
                // í¼ ë¡œê·¸ì¸ ì„¤ì •
                .formLogin(form -> form
                        .loginPage("/login")           // ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€
                        .defaultSuccessUrl("/dashboard", true)  // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™í•  í˜ì´ì§€
                        .permitAll()
                )
                
                // ë¡œê·¸ì•„ì›ƒ ì„¤ì •
                .logout(logout -> logout
                        .logoutUrl("/logout")
                        .logoutSuccessUrl("/login?logout")
                        .permitAll()
                )
                
                // JWT í•„í„°ë¥¼ Spring Security í•„í„° ì²´ì¸ì— ì¶”ê°€
                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);
        
        return http.build();
    }
}
```

---

## CORS ì„¤ì •

### CORS ì„¤ì • í´ë˜ìŠ¤
```java
@Configuration
@EnableWebMvc  // Spring MVC ì„¤ì • í™œì„±í™”
public class CorsConfig implements WebMvcConfigurer {
    
    /**
     * CORS(Cross-Origin Resource Sharing) ì„¤ì •
     * ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ API í˜¸ì¶œì„ í—ˆìš©í•˜ê¸° ìœ„í•œ ì„¤ì •
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry
                .addMapping("/**")                      // ëª¨ë“  ê²½ë¡œì— ëŒ€í•´ CORS í—ˆìš©
                .allowedOriginPatterns("*")             // ëª¨ë“  ì˜¤ë¦¬ì§„ í—ˆìš© (ê°œë°œí™˜ê²½ìš©)
                .allowedMethods(                        // í—ˆìš©í•  HTTP ë©”ì†Œë“œ
                        "GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS")
                .allowedHeaders("*")                    // ëª¨ë“  í—¤ë” í—ˆìš©
                .allowCredentials(true)                 // ì¸ì¦ ì •ë³´(ì¿ í‚¤, Authorization í—¤ë” ë“±) í—ˆìš©
                .maxAge(3600);                          // preflight ìš”ì²­ ê²°ê³¼ ìºì‹œ ì‹œê°„(ì´ˆ)
    }
    
    /**
     * ê¸€ë¡œë²Œ CORS ì„¤ì •ì„ ìœ„í•œ Bean
     * ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œëŠ” íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
     */
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        
        // ìš´ì˜í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ ë„ë©”ì¸ ì£¼ì†Œë¡œ ë³€ê²½
        configuration.setAllowedOriginPatterns(Arrays.asList("*"));
        
        configuration.setAllowedMethods(Arrays.asList(
                "GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"));
        
        configuration.setAllowedHeaders(Arrays.asList("*"));
        configuration.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);  // ëª¨ë“  ê²½ë¡œì— ì ìš©
        
        return source;
    }
}
```

---

## Thymeleaf í…œí”Œë¦¿

### ë¡œê·¸ì¸ í˜ì´ì§€ (login.html)
```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - JWT ì¸ì¦ ì‹œìŠ¤í…œ</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ë¡œê·¸ì¸ í˜ì´ì§€ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
        }
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="login-container">
                    <h2 class="text-center mb-4">ğŸ” ë¡œê·¸ì¸</h2>
                    
                    <!-- ë¡œê·¸ì¸ í¼ -->
                    <form id="loginForm" method="post" action="/auth/login">
                        <div class="mb-3">
                            <label for="username" class="form-label">ì‚¬ìš©ìëª…</label>
                            <input type="text" class="form-control" id="username" 
                                   name="username" required placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        
                        <div class="mb-3">
                            <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="password" 
                                   name="password" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                ë¡œê·¸ì¸ ì •ë³´ ê¸°ì–µí•˜ê¸°
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            ë¡œê·¸ì¸
                        </button>
                        
                        <div class="text-center">
                            <p class="mb-0">ê³„ì •ì´ ì—†ìœ¼ì‹œë‚˜ìš”? 
                                <a href="/register" class="text-decoration-none">íšŒì›ê°€ì…</a>
                            </p>
                        </div>
                    </form>
                    
                    <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
                    <div id="errorAlert" class="alert alert-danger mt-3" style="display: none;">
                        <span id="errorMessage"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        /**
         * ë¡œê·¸ì¸ í¼ ì œì¶œ ì²˜ë¦¬
         * AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬
         */
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = new FormData(this);
            const loginData = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            try {
                // ë¡œê·¸ì¸ API í˜¸ì¶œ
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(loginData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // JWT í† í°ì„ localStorageì— ì €ì¥
                    localStorage.setItem('jwt_token', result.token);
                    
                    // ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                    window.location.href = '/dashboard';
                } else {
                    // ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                    const error = await response.json();
                    showError(error.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                showError('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
        
        /**
         * ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {string} message - í‘œì‹œí•  ì˜¤ë¥˜ ë©”ì‹œì§€
         */
        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = message;
            errorAlert.style.display = 'block';
            
            // 5ì´ˆ í›„ ì˜¤ë¥˜ ë©”ì‹œì§€ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                errorAlert.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
```

### ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ (dashboard.html)
```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì‹œë³´ë“œ - JWT ì¸ì¦ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-2"></i>JWT ì¸ì¦ ì‹œìŠ¤í…œ
            </a>
            
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    í™˜ì˜í•©ë‹ˆë‹¤, <span id="username" th:text="${username}"></span>ë‹˜!
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-1"></i>ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </nav>
    
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>ëŒ€ì‹œë³´ë“œ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- ì‚¬ìš©ì ì •ë³´ ì¹´ë“œ -->
                            <div class="col-md-4 mb-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">ì‚¬ìš©ì ì •ë³´</h6>
                                                <p class="mb-0" th:text="${username}">ì‚¬ìš©ìëª…</p>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-user fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ê¶Œí•œ ì •ë³´ ì¹´ë“œ -->
                            <div class="col-md-4 mb-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">ê¶Œí•œ</h6>
                                                <p class="mb-0" th:text="${roles}">USER</p>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-key fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- í† í° ìƒíƒœ ì¹´ë“œ -->
                            <div class="col-md-4 mb-3">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">í† í° ìƒíƒœ</h6>
                                                <p class="mb-0" id="tokenStatus">ìœ íš¨</p>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-check-circle fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <h5><i class="fas fa-flask me-2"></i>API í…ŒìŠ¤íŠ¸</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <button class="btn btn-primary me-2" onclick="testProtectedAPI()">
                                            ë³´í˜¸ëœ API í˜¸ì¶œ
                                        </button>
                                        <button class="btn btn-warning me-2" onclick="testAdminAPI()">
                                            ê´€ë¦¬ì API í˜¸ì¶œ
                                        </button>
                                        <button class="btn btn-info" onclick="refreshToken()">
                                            í† í° ê°±ì‹ 
                                        </button>
                                        
                                        <div class="mt-3">
                                            <h6>API ì‘ë‹µ:</h6>
                                            <pre id="apiResponse" class="bg-light p-3 rounded">ì—¬ê¸°ì— API ì‘ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤.</pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        /**
         * í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ìƒíƒœ í™•ì¸
         */
        document.addEventListener('DOMContentLoaded', function() {
            checkTokenStatus();
        });
        
        /**
         * JWT í† í° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
         */
        function checkTokenStatus() {
            const token = localStorage.getItem('jwt_token');
            const statusElement = document.getElementById('tokenStatus');
            
            if (token) {
                // í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ í™•ì¸í•´ì•¼ í•¨)
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const currentTime = Date.now() / 1000;
                    
                    if (payload.exp && payload.exp > currentTime) {
                        statusElement.textContent = 'ìœ íš¨';
                        statusElement.parentElement.parentElement.className = 'card bg-success text-white';
                    } else {
                        statusElement.textContent = 'ë§Œë£Œë¨';
                        statusElement.parentElement.parentElement.className = 'card bg-danger text-white';
                    }
                } catch (error) {
                    statusElement.textContent = 'ì˜¤ë¥˜';
                    statusElement.parentElement.parentElement.className = 'card bg-warning text-white';
                }
            } else {
                statusElement.textContent = 'ì—†ìŒ';
                statusElement.parentElement.parentElement.className = 'card bg-secondary text-white';
            }
        }
        
        /**
         * ë³´í˜¸ëœ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
         */
        async function testProtectedAPI() {
            const token = localStorage.getItem('jwt_token');
            const responseElement = document.getElementById('apiResponse');
            
            try {
                const response = await fetch('/api/user/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                responseElement.textContent = JSON.stringify(data, null, 2);
                
                if (!response.ok) {
                    throw new Error(data.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }
            } catch (error) {
                responseElement.textContent = `ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        /**
         * ê´€ë¦¬ì ì „ìš© APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
         */
        async function testAdminAPI() {
            const token = localStorage.getItem('jwt_token');
            const responseElement = document.getElementById('apiResponse');
            
            try {
                const response = await fetch('/api/admin/users', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                responseElement.textContent = JSON.stringify(data, null, 2);
                
                if (!response.ok) {
                    throw new Error(data.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }
            } catch (error) {
                responseElement.textContent = `ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        /**
         * í† í°ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
         */
        async function refreshToken() {
            const token = localStorage.getItem('jwt_token');
            const responseElement = document.getElementById('apiResponse');
            
            try {
                const response = await fetch('/auth/refresh', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('jwt_token', data.token);
                    responseElement.textContent = 'í† í°ì´ ì„±ê³µì ìœ¼ë¡œ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    checkTokenStatus(); // ìƒíƒœ ì—…ë°ì´íŠ¸
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'í† í° ê°±ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                responseElement.textContent = `í† í° ê°±ì‹  ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        /**
         * ë¡œê·¸ì•„ì›ƒì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         */
        function logout() {
            // localStorageì—ì„œ í† í° ì œê±°
            localStorage.removeItem('jwt_token');
            
            // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/login';
        }
    </script>
</body>
</html>
```

---

## ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„

### ì¸ì¦ ì»¨íŠ¸ë¡¤ëŸ¬
```java
@RestController
@RequestMapping("/auth")
public class AuthController {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private JwtService jwtService;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    /**
     * ì‚¬ìš©ì ë¡œê·¸ì¸ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
     * @param loginRequest ë¡œê·¸ì¸ ìš”ì²­ ë°ì´í„°
     * @return JWT í† í°ì„ í¬í•¨í•œ ì‘ë‹µ
     */
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest loginRequest) {
        try {
            // ì‚¬ìš©ì ì¡°íšŒ
            User user = userService.findByUsername(loginRequest.getUsername())
                    .orElseThrow(() -> new RuntimeException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
            
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!passwordEncoder.matches(loginRequest.getPassword(), user.getPassword())) {
                return ResponseEntity.badRequest()
                        .body(new AuthResponse("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", null));
            }
            
            // JWT í† í° ìƒì„±
            String token = jwtService.generateToken(user.getUsername(), user.getRoleList());
            
            return ResponseEntity.ok(new AuthResponse("ë¡œê·¸ì¸ ì„±ê³µ", token));
            
        } catch (Exception e) {
            return ResponseEntity.badRequest()
                    .body(new AuthResponse("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.getMessage(), null));
        }
    }
    
    /**
     * ì‚¬ìš©ì íšŒì›ê°€ì…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
     * @param registerRequest íšŒì›ê°€ì… ìš”ì²­ ë°ì´í„°
     * @return íšŒì›ê°€ì… ê²°ê³¼
     */
    @PostMapping("/register")
    public ResponseEntity<?> register(@RequestBody RegisterRequest registerRequest) {
        try {
            // ì‚¬ìš©ìëª… ì¤‘ë³µ í™•ì¸
            if (userService.existsByUsername(registerRequest.getUsername())) {
                return ResponseEntity.badRequest()
                        .body(new AuthResponse("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.", null));
            }
            
            // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
            if (userService.existsByEmail(registerRequest.getEmail())) {
                return ResponseEntity.badRequest()
                        .body(new AuthResponse("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.", null));
            }
            
            // ìƒˆ ì‚¬ìš©ì ìƒì„±
            User newUser = new User();
            newUser.setUsername(registerRequest.getUsername());
            newUser.setPassword(passwordEncoder.encode(registerRequest.getPassword()));
            newUser.setEmail(registerRequest.getEmail());
            newUser.setRoles("USER"); // ê¸°ë³¸ ê¶Œí•œ
            
            // ì‚¬ìš©ì ì €ì¥
            userService.save(newUser);
            
            return ResponseEntity.ok(new AuthResponse("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", null));
            
        } catch (Exception e) {
            return ResponseEntity.badRequest()
                    .body(new AuthResponse("íšŒì›ê°€ì… ì‹¤íŒ¨: " + e.getMessage(), null));
        }
    }
    
    /**
     * JWT í† í°ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
     * @param request HTTP ìš”ì²­ (Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ)
     * @return ìƒˆë¡œìš´ JWT í† í°
     */
    @PostMapping("/refresh")
    public ResponseEntity<?> refreshToken(HttpServletRequest request) {
        try {
            // ìš”ì²­ í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ
            String token = getTokenFromRequest(request);
            
            if (token == null || !jwtService.validateToken(token)) {
                return ResponseEntity.badRequest()
                        .body(new AuthResponse("ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤.", null));
            }
            
            // í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
            String username = jwtService.getUsernameFromToken(token);
            List<String> roles = jwtService.getRolesFromToken(token);
            
            // ìƒˆ í† í° ìƒì„±
            String newToken = jwtService.generateToken(username, roles);
            
            return ResponseEntity.ok(new AuthResponse("í† í° ê°±ì‹  ì„±ê³µ", newToken));
            
        } catch (Exception e) {
            return ResponseEntity.badRequest()
                    .body(new AuthResponse("í† í° ê°±ì‹  ì‹¤íŒ¨: " + e.getMessage(), null));
        }
    }
    
    /**
     * HTTP ìš”ì²­ì—ì„œ JWT í† í°ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
     */
    private String getTokenFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
    
    // ìš”ì²­/ì‘ë‹µ DTO í´ë˜ìŠ¤ë“¤
    @Data
    public static class LoginRequest {
        private String username;
        private String password;
    }
    
    @Data
    public static class RegisterRequest {
        private String username;
        private String password;
        private String email;
    }
    
    @Data
    @AllArgsConstructor
    public static class AuthResponse {
        private String message;
        private String token;
    }
}
```

### API ì»¨íŠ¸ë¡¤ëŸ¬
```java
@RestController
@RequestMapping("/api")
public class ApiController {
    
    @Autowired
    private UserService userService;
    
    /**
     * í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @param authentication Spring Security ì¸ì¦ ê°ì²´
     * @return ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´
     */
    @GetMapping("/user/profile")
    public ResponseEntity<?> getUserProfile(Authentication authentication) {
        try {
            // í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ìëª… ê°€ì ¸ì˜¤ê¸°
            String username = authentication.getName();
            
            // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
            User user = userService.findByUsername(username)
                    .orElseThrow(() -> new RuntimeException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
            
            // ë¹„ë°€ë²ˆí˜¸ ì œì™¸í•œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
            UserProfileResponse profile = new UserProfileResponse();
            profile.setId(user.getId());
            profile.setUsername(user.getUsername());
            profile.setEmail(user.getEmail());
            profile.setRoles(user.getRoleList());
            
            return ResponseEntity.ok(profile);
            
        } catch (Exception e) {
            return ResponseEntity.badRequest()
                    .body(Map.of("error", "í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨: " + e.getMessage()));
        }
    }
    
    /**
     * ê´€ë¦¬ì ì „ìš©: ëª¨ë“  ì‚¬ìš©ì ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @return ì‚¬ìš©ì ëª©ë¡
     */
    @GetMapping("/admin/users")
    @PreAuthorize("hasRole('ADMIN')")  // ADMIN ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
    public ResponseEntity<?> getAllUsers() {
        try {
            List<User> users = userService.findAll();
            
            // ë¹„ë°€ë²ˆí˜¸ ì œì™¸í•œ ì‚¬ìš©ì ì •ë³´ ëª©ë¡ ìƒì„±
            List<UserProfileResponse> userProfiles = users.stream()
                    .map(user -> {
                        UserProfileResponse profile = new UserProfileResponse();
                        profile.setId(user.getId());
                        profile.setUsername(user.getUsername());
                        profile.setEmail(user.getEmail());
                        profile.setRoles(user.getRoleList());
                        return profile;
                    })
                    .collect(Collectors.toList());
            
            return ResponseEntity.ok(userProfiles);
            
        } catch (Exception e) {
            return ResponseEntity.badRequest()
                    .body(Map.of("error", "ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: " + e.getMessage()));
        }
    }
    
    /**
     * í…ŒìŠ¤íŠ¸ìš© ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸
     * @param authentication ì¸ì¦ ì •ë³´
     * @return í…ŒìŠ¤íŠ¸ ì‘ë‹µ
     */
    @GetMapping("/protected")
    public ResponseEntity<?> protectedEndpoint(Authentication authentication) {
        return ResponseEntity.ok(Map.of(
                "message", "ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ì— ì„±ê³µì ìœ¼ë¡œ ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.",
                "user", authentication.getName(),
                "authorities", authentication.getAuthorities(),
                "timestamp", new Date()
        ));
    }
    
    @Data
    public static class UserProfileResponse {
        private Long id;
        private String username;
        private String email;
        private List<String> roles;
    }
}
```

---

## ì‹¤ë¬´ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### ğŸ” ë³´ì•ˆ ê°•í™” ë°©ì•ˆ

#### 1. í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
```yaml
# application.yml
app:
  jwt:
    secret: ${JWT_SECRET:defaultSecretKeyThatShouldBeChangedInProduction}
    expiration: ${JWT_EXPIRATION:86400000}  # 24ì‹œê°„ (ë°€ë¦¬ì´ˆ)
    refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}  # 7ì¼

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  datasource:
    url: ${DB_URL:jdbc:h2:mem:testdb}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}
  
  jpa:
    hibernate:
      ddl-auto: ${DDL_AUTO:update}
    show-sql: ${SHOW_SQL:true}
```

#### 2. Refresh Token êµ¬í˜„
```java
@Service
public class RefreshTokenService {
    
    @Autowired
    private RefreshTokenRepository refreshTokenRepository;
    
    /**
     * Refresh Token ìƒì„± ë° ì €ì¥
     */
    public RefreshToken createRefreshToken(String username) {
        RefreshToken refreshToken = new RefreshToken();
        refreshToken.setUsername(username);
        refreshToken.setToken(UUID.randomUUID().toString());
        refreshToken.setExpiryDate(Instant.now().plusMillis(refreshTokenDuration));
        
        return refreshTokenRepository.save(refreshToken);
    }
    
    /**
     * Refresh Token ê²€ì¦
     */
    public Optional<RefreshToken> findByToken(String token) {
        return refreshTokenRepository.findByToken(token);
    }
    
    /**
     * Refresh Token ë§Œë£Œ í™•ì¸
     */
    public RefreshToken verifyExpiration(RefreshToken token) {
        if (token.getExpiryDate().compareTo(Instant.now()) < 0) {
            refreshTokenRepository.delete(token);
            throw new TokenRefreshException(token.getToken(), 
                    "Refresh token was expired. Please make a new signin request");
        }
        return token;
    }
}
```

### ğŸ“Š í˜„ì—…ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´

#### 1. **Access Token + Refresh Token íŒ¨í„´** â­â­â­â­â­
```java
// ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´
// - Access Token: ì§§ì€ ë§Œë£Œì‹œê°„ (15ë¶„~1ì‹œê°„)
// - Refresh Token: ê¸´ ë§Œë£Œì‹œê°„ (1ì£¼~1ê°œì›”)
// - ë³´ì•ˆì„±ê³¼ ì‚¬ìš©ì„±ì˜ ê· í˜•
```

#### 2. **Redisë¥¼ í™œìš©í•œ í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸** â­â­â­â­
```java
@Service
public class TokenBlacklistService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public void blacklistToken(String token, long expiration) {
        // í† í°ì„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ë§Œë£Œì‹œê°„ê¹Œì§€)
        redisTemplate.opsForValue().set(
            "blacklist:" + token, 
            "true", 
            expiration, 
            TimeUnit.MILLISECONDS
        );
    }
    
    public boolean isTokenBlacklisted(String token) {
        return Boolean.TRUE.equals(
            redisTemplate.hasKey("blacklist:" + token)
        );
    }
}
```

#### 3. **Role-Based Access Control (RBAC)** â­â­â­â­â­
```java
// í˜„ì—…ì—ì„œ ê°€ì¥ ì„ í˜¸í•˜ëŠ” ê¶Œí•œ ê´€ë¦¬ ë°©ì‹
@PreAuthorize("hasRole('ADMIN') or (hasRole('USER') and #userId == authentication.principal.id)")
@GetMapping("/users/{userId}")
public ResponseEntity<?> getUser(@PathVariable Long userId) {
    // ê´€ë¦¬ìì´ê±°ë‚˜ ë³¸ì¸ì˜ ì •ë³´ë§Œ ì¡°íšŒ ê°€ëŠ¥
}
```

### ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "Client Side"
        A[React/Vue/Angular App]
        B[Mobile App]
        C[Thymeleaf Templates]
    end
    
    subgraph "Load Balancer"
        D[Nginx/HAProxy]
    end
    
    subgraph "Application Layer"
        E[Spring Boot App 1]
        F[Spring Boot App 2]
        G[Spring Boot App N]
    end
    
    subgraph "Cache Layer"
        H[Redis Cluster]
    end
    
    subgraph "Database Layer"
        I[Primary DB]
        J[Replica DB]
    end
    
    subgraph "External Services"
        K[OAuth2 Provider]
        L[Email Service]
        M[Monitoring]
    end
    
    A --> D
    B --> D
    C --> D
    
    D --> E
    D --> F
    D --> G
    
    E --> H
    F --> H
    G --> H
    
    E --> I
    F --> J
    G --> I
    
    E --> K
    E --> L
    E --> M
    
    style H fill:#ffcccb
    style I fill:#90EE90
    style K fill:#87CEEB
```

### ğŸš€ ì„±ëŠ¥ ìµœì í™” íŒ

#### 1. **JWT í† í° í¬ê¸° ìµœì†Œí™”**
```java
// âŒ ë‚˜ìœ ì˜ˆ: ë¶ˆí•„ìš”í•œ ì •ë³´ í¬í•¨
public String generateToken(User user) {
    return Jwts.builder()
        .setSubject(user.getUsername())
        .claim("fullUserObject", user)  // ì „ì²´ ì‚¬ìš©ì ê°ì²´ í¬í•¨ (ìœ„í—˜)
        .claim("permissions", getAllPermissions(user))  // ë„ˆë¬´ ë§ì€ ê¶Œí•œ ì •ë³´
        .signWith(key)
        .compact();
}

// âœ… ì¢‹ì€ ì˜ˆ: í•„ìˆ˜ ì •ë³´ë§Œ í¬í•¨
public String generateToken(String username, List<String> roles) {
    return Jwts.builder()
        .setSubject(username)
        .claim("roles", roles)  // ìµœì†Œí•œì˜ ê¶Œí•œ ì •ë³´ë§Œ
        .setIssuedAt(new Date())
        .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
        .signWith(key)
        .compact();
}
```

#### 2. **í† í° ê²€ì¦ ìºì‹±**
```java
@Service
public class CachedJwtService {
    
    private final Cache<String, Boolean> tokenValidationCache = 
            Caffeine.newBuilder()
                .maximumSize(10000)
                .expireAfterWrite(5, TimeUnit.MINUTES)  // 5ë¶„ ìºì‹œ
                .build();
    
    public boolean validateTokenWithCache(String token) {
        return tokenValidationCache.get(token, this::validateTokenInternal);
    }
}
```

### âš ï¸ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

#### 1. **JWT ì €ì¥ ìœ„ì¹˜** (í´ë¼ì´ì–¸íŠ¸)
```javascript
// âŒ ìœ„í—˜: localStorage (XSS ê³µê²© ì·¨ì•½)
localStorage.setItem('jwt_token', token);

// âš ï¸ ì£¼ì˜: sessionStorage (XSS ê³µê²© ì·¨ì•½í•˜ì§€ë§Œ íƒ­ ì¢…ë£Œ ì‹œ ì‚­ì œ)
sessionStorage.setItem('jwt_token', token);

// âœ… ì•ˆì „: HttpOnly ì¿ í‚¤ (XSS ê³µê²© ë°©ì–´, í•˜ì§€ë§Œ CSRF ì£¼ì˜)
// ì„œë²„ì—ì„œ Set-Cookie: token=jwt; HttpOnly; Secure; SameSite=Strict
```

#### 2. **CORS ì„¤ì •** (ìš´ì˜í™˜ê²½)
```java
// âŒ ê°œë°œí™˜ê²½ìš© (ìš´ì˜ ê¸ˆì§€)
.allowedOriginPatterns("*")

// âœ… ìš´ì˜í™˜ê²½ìš©
.allowedOrigins(
    "https://yourdomain.com",
    "https://www.yourdomain.com",
    "https://mobile.yourdomain.com"
)
```

### ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

```java
@Component
@Slf4j
public class JwtAuditFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response, 
                                  FilterChain filterChain) throws ServletException, IOException {
        
        String token = getTokenFromRequest(request);
        String clientIp = getClientIp(request);
        String userAgent = request.getHeader("User-Agent");
        
        if (token != null) {
            try {
                String username = jwtService.getUsernameFromToken(token);
                
                // ì„±ê³µ ë¡œê¹…
                log.info("JWT_ACCESS_SUCCESS - User: {}, IP: {}, UserAgent: {}, Endpoint: {}", 
                        username, clientIp, userAgent, request.getRequestURI());
                        
            } catch (Exception e) {
                // ì‹¤íŒ¨ ë¡œê¹…
                log.warn("JWT_ACCESS_FAILED - IP: {}, UserAgent: {}, Endpoint: {}, Error: {}", 
                        clientIp, userAgent, request.getRequestURI(), e.getMessage());
            }
        }
        
        filterChain.doFilter(request, response);
    }
}
```

### ğŸ”§ ìš´ì˜í™˜ê²½ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] **ë³´ì•ˆ**
  - [ ] JWT ë¹„ë°€í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
  - [ ] HTTPS ì‚¬ìš© ê°•ì œ
  - [ ] CORS ì„¤ì •ì„ íŠ¹ì • ë„ë©”ì¸ìœ¼ë¡œ ì œí•œ
  - [ ] Rate Limiting êµ¬í˜„
  - [ ] SQL Injection ë°©ì–´

- [ ] **ì„±ëŠ¥**  
  - [ ] í† í° ê²€ì¦ ìºì‹± ì ìš©
  - [ ] ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ ìµœì í™”
  - [ ] ì •ì  ë¦¬ì†ŒìŠ¤ CDN ì‚¬ìš©

- [ ] **ëª¨ë‹ˆí„°ë§**
  - [ ] ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œ êµ¬ì¶• (ELK Stack)
  - [ ] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Micrometer + Prometheus)
  - [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•

- [ ] **ë°±ì—… ë° ë³µêµ¬**
  - [ ] ë°ì´í„°ë² ì´ìŠ¤ ì •ê¸° ë°±ì—…
  - [ ] ì¬í•´ ë³µêµ¬ ê³„íš ìˆ˜ë¦½

ì´ ê°€ì´ë“œëŠ” JWT ì¸ì¦ ì‹œìŠ¤í…œì˜ ì™„ì „í•œ êµ¬í˜„ì„ ë‹¤ë£¨ë©°, ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ğŸš€
