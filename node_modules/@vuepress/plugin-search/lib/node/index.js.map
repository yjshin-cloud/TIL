{"version":3,"file":"index.js","sources":["../../src/node/prepareSearchIndex.ts","../../src/node/locales.ts","../../src/node/searchPlugin.ts"],"sourcesContent":["import type { App } from 'vuepress/core'\nimport type { SearchIndex } from '../shared/index.js'\nimport type { SearchPluginOptions } from './searchPlugin.js'\n\nconst HMR_CODE = `\nif (import.meta.webpackHot) {\n  import.meta.webpackHot.accept()\n  if (__VUE_HMR_RUNTIME__.updateSearchIndex) {\n    __VUE_HMR_RUNTIME__.updateSearchIndex(searchIndex)\n  }\n}\n\nif (import.meta.hot) {\n  import.meta.hot.accept(({ searchIndex }) => {\n    __VUE_HMR_RUNTIME__.updateSearchIndex(searchIndex)\n  })\n}\n`\n\nexport const prepareSearchIndex = async ({\n  app,\n  isSearchable,\n  getExtraFields,\n}: {\n  app: App\n  isSearchable: Required<SearchPluginOptions>['isSearchable']\n  getExtraFields: Required<SearchPluginOptions>['getExtraFields']\n}): Promise<string> => {\n  // generate search index\n  const searchIndex: SearchIndex = app.pages\n    .filter(isSearchable)\n    .map((page) => ({\n      title: page.title,\n      headers: page.headers,\n      path: page.path,\n      pathLocale: page.pathLocale,\n      extraFields: getExtraFields(page),\n    }))\n\n  // search index file content\n  let content = `\\\nexport const SEARCH_INDEX = ${JSON.stringify(searchIndex, null, 2)}\n`\n\n  // inject HMR code\n  if (app.env.isDev) {\n    content += HMR_CODE\n  }\n\n  return app.writeTemp('internal/searchIndex.js', content)\n}\n","import type { DefaultLocaleInfo } from '@vuepress/helper'\nimport type { SearchPluginLocaleData } from '../shared/index.js'\n\n/**\n * Default locale info for `@vuepress/plugin-search`\n */\nexport const searchLocaleInfo: DefaultLocaleInfo<SearchPluginLocaleData> = [\n  [['en', 'en-US'], { placeholder: 'Search' }],\n  [['zh', 'zh-CN', 'zh-Hans', 'zh-TW', 'zh-Hant'], { placeholder: '搜索' }],\n  [['de', 'de-DE'], { placeholder: 'Suche' }],\n  [['de-AT'], { placeholder: 'Suche' }],\n  [['vi', 'vi-VN'], { placeholder: 'Tìm kiếm' }],\n  [['uk'], { placeholder: 'Пошук' }],\n  [['ru', 'ru-RU'], { placeholder: 'Поиск' }],\n  [['br'], { placeholder: 'Pesquisar' }],\n  [['pl', 'pl-PL'], { placeholder: 'Szukaj' }],\n  [['sk', 'sk-SK'], { placeholder: 'Hľadať' }],\n  [['fr', 'fr-FR'], { placeholder: 'Rechercher' }],\n  [['es', 'es-ES'], { placeholder: 'Buscar' }],\n  [['ja', 'ja-JP'], { placeholder: '検索' }],\n  [['tr', 'tr-TR'], { placeholder: 'Ara' }],\n  [['ko', 'ko-KO'], { placeholder: '검색' }],\n  [['fi', 'fi-FI'], { placeholder: 'Etsi' }],\n  [['hu', 'hu-HU'], { placeholder: 'Keresés' }],\n  [['id', 'id-ID'], { placeholder: 'Cari sesuatu' }],\n  [['nl', 'nl-NL'], { placeholder: 'Zoeken' }],\n]\n","import type { KeyOptions } from '@vuepress/helper'\nimport { getFullLocaleConfig } from '@vuepress/helper'\nimport { watch } from 'chokidar'\nimport type { Page, Plugin } from 'vuepress/core'\nimport type { LocaleConfig } from 'vuepress/shared'\nimport { getDirname, path } from 'vuepress/utils'\nimport type { SearchPluginLocaleData } from '../shared/index.js'\nimport { searchLocaleInfo } from './locales.js'\nimport { prepareSearchIndex } from './prepareSearchIndex.js'\n\nconst __dirname = import.meta.dirname || getDirname(import.meta.url)\n\n/**\n * Options for @vuepress/plugin-search\n */\nexport interface SearchPluginOptions {\n  /**\n   * Locales config for search box\n   */\n  locales?: LocaleConfig<SearchPluginLocaleData>\n\n  /**\n   * Specify the [event.key](http://keycode.info/) of the hotkeys\n   *\n   * When hotkeys are pressed, the search box input will be focused\n   *\n   * Set to an empty array to disable hotkeys\n   *\n   * @default ['s', '/']\n   */\n  hotKeys?: (KeyOptions | string)[]\n\n  /**\n   * Specify the maximum number of search results\n   *\n   * @default 5\n   */\n  maxSuggestions?: number\n\n  /**\n   * A function to determine whether a page should be included in the search index\n   */\n  isSearchable?: (page: Page) => boolean\n\n  /**\n   * A function to add extra fields to the search index of a page\n   */\n  getExtraFields?: (page: Page) => string[]\n}\n\nconst PLUGIN_NAME = '@vuepress/plugin-search'\n\nexport const searchPlugin = ({\n  locales = {},\n  hotKeys = ['s', '/'],\n  maxSuggestions = 5,\n  isSearchable = () => true,\n  getExtraFields = () => [],\n}: SearchPluginOptions = {}): Plugin => ({\n  name: PLUGIN_NAME,\n\n  clientConfigFile: path.resolve(__dirname, '../client/config.js'),\n\n  define: (app) => ({\n    __SEARCH_HOT_KEYS__: hotKeys,\n    __SEARCH_LOCALES__: getFullLocaleConfig({\n      app,\n      name: PLUGIN_NAME,\n      default: searchLocaleInfo,\n      config: locales,\n    }),\n    __SEARCH_MAX_SUGGESTIONS__: maxSuggestions,\n  }),\n\n  onPrepared: async (app) => {\n    await prepareSearchIndex({ app, isSearchable, getExtraFields })\n  },\n\n  onWatched: (app, watchers) => {\n    // here we only watch the page data files\n    // if the extra fields generated by `getExtraFields` are not included\n    // in the page data, the changes may not be watched\n    const searchIndexWatcher = watch('pages', {\n      cwd: app.dir.temp(),\n      // only watch js files\n      ignored: (fsPath, stats) =>\n        Boolean(stats?.isFile() && !fsPath.endsWith('.js')),\n    })\n    searchIndexWatcher.on('add', () => {\n      void prepareSearchIndex({ app, isSearchable, getExtraFields })\n    })\n    searchIndexWatcher.on('change', () => {\n      void prepareSearchIndex({ app, isSearchable, getExtraFields })\n    })\n    searchIndexWatcher.on('unlink', () => {\n      void prepareSearchIndex({ app, isSearchable, getExtraFields })\n    })\n    watchers.push(searchIndexWatcher)\n  },\n})\n"],"names":["HMR_CODE","prepareSearchIndex","app","isSearchable","getExtraFields","searchIndex","page","content","searchLocaleInfo","__dirname","getDirname","PLUGIN_NAME","searchPlugin","locales","hotKeys","maxSuggestions","path","getFullLocaleConfig","watchers","searchIndexWatcher","watch","fsPath","stats"],"mappings":"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"}