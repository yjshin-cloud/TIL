import{useLocale as N,useKeys as A}from"@vuepress/helper/client";import{ref as p,computed as S,defineComponent as F,toRefs as K,h as n}from"vue";import{useRouter as U,useRouteLocale as j}from"vuepress/client";import{SEARCH_INDEX as B}from"@internal/searchIndex";const k=p(B),w=()=>k;__VUEPRESS_DEV__&&(import.meta.webpackHot||import.meta.hot)&&(__VUE_HMR_RUNTIME__.updateSearchIndex=t=>{k.value=t});const H=/[^\x00-\x7F]/,P=t=>t.split(/\s+/g).map(e=>e.trim()).filter(e=>!!e),I=t=>t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),b=(t,e)=>{const c=e.join(" "),l=P(t);if(H.test(t))return l.some(o=>c.toLowerCase().includes(o));const v=t.endsWith(" ");return new RegExp(`${l.map((o,s)=>l.length===s+1&&!v?`(?=.*\\b${I(o)})`:`(?=.*\\b${I(o)}\\b)`).join("")}.+`,"gi").test(c)},E=({searchIndex:t,routeLocale:e,query:c,maxSuggestions:l})=>{const v=S(()=>t.value.filter(o=>o.pathLocale===e.value));return S(()=>{const o=c.value.trim().toLowerCase();if(!o)return[];const s=[],f=(a,u)=>{b(o,[u.title])&&s.push({link:`${a.path}#${u.slug}`,title:a.title,header:u.title});for(const i of u.children){if(s.length>=l.value)return;f(a,i)}};for(const a of v.value){if(s.length>=l.value)break;if(b(o,[a.title,...a.extraFields])){s.push({link:a.path,title:a.title});continue}for(const u of a.headers){if(s.length>=l.value)break;f(a,u)}}return s})},$=t=>{const e=p(0);return{focusIndex:e,focusNext:()=>{e.value<t.value.length-1?e.value+=1:e.value=0},focusPrev:()=>{e.value>0?e.value-=1:e.value=t.value.length-1}}},V=F({name:"SearchBox",props:{locales:{type:Object,default:()=>({})},hotKeys:Array,maxSuggestions:{type:Number,default:5}},setup(t){const{locales:e,hotKeys:c,maxSuggestions:l}=K(t),v=N(e),o=U(),s=j(),f=w(),a=p(null),u=p(!1),i=p(""),g=E({searchIndex:f,routeLocale:s,query:i,maxSuggestions:l}),{focusIndex:h,focusNext:L,focusPrev:R}=$(g);A(c,()=>{a.value?.focus()});const m=S(()=>u.value&&!!g.value.length),M=()=>{m.value&&R()},C=()=>{m.value&&L()},y=r=>{if(!m.value)return;const d=g.value[r];d&&o.push(d.link).then(()=>{i.value="",h.value=0})};return()=>n("form",{class:"search-box",role:"search"},[n("input",{ref:a,type:"search",placeholder:v.value.placeholder,autocomplete:"off",spellcheck:!1,value:i.value,onFocus:()=>{u.value=!0},onBlur:()=>{u.value=!1},onInput:r=>{i.value=r.target.value},onKeydown:r=>{switch(r.key){case"ArrowUp":{M();break}case"ArrowDown":{C();break}case"Enter":{r.preventDefault(),y(h.value);break}}}}),m.value&&n("ul",{class:"suggestions",onMouseleave:()=>{h.value=-1}},g.value.map(({link:r,title:d,header:_},x)=>n("li",{class:["suggestion",{focus:h.value===x}],onMouseenter:()=>{h.value=x},onMousedown:()=>{y(x)}},n("a",{href:r,onClick:D=>{D.preventDefault()}},[n("span",{class:"page-title"},d),_&&n("span",{class:"page-header"},`> ${_}`)]))))])}});export{V as SearchBox,b as isQueryMatched,k as searchIndex,w as useSearchIndex,E as useSearchSuggestions,$ as useSuggestionsFocus};
//# sourceMappingURL=index.js.map
